### C# 박싱과 언박싱

> 출처: https://hongjinhyeon.tistory.com/90 [생각대로 살지 않으면 사는대로 생각한다.]

일반적인 프로그램을 만들면 이 개념에 대해서 몰라도 개발은 가능합니다.

그러나 사용되는 메모리가 많거나 관리가 필요하다면 필수적으로 알아야할 내용입니다.



1. 박싱(Boxing)

값 타입을 Object형식 또는 이 값 형식에서 구현된 임의의 인터페이스 형식으로 변환하는 것을 말합니다.

기존에 저장된 스택영역에서 힙영역에 값형식을 저장합니다.

```
int i = 123;
object o = i;
```

위에서 int의 값형식을 Object라는 참조형식으로 형변환을 시도합니다. 그 목적은 여러가지 있을 수 있는데, 보통 파라미터로 전달되거나 , List<Object> 형식으로 모든 값들을 입력 받는 목적으로도 사용될 수 있습니다.

위의 코드는 메모리상에서 아래와 같이 메모리가 할당이 됩니다.

![image-20200116141915231](../../image\image-20200116141915231.png)

스택영역에 있는 i값이 o로 변환이 되면서 힙영역에 object형식으로 선언이 되고 값이 복사됩니다.

o는 스택영역에 존재하며 boxed된 i의 주소값을 가지고 있습니다.



박싱은 보통 암시적으로 되며, 명시적으로도 가능합니다.



2. 언박싱 (UnBoxing)

Object 형식에서 값형식으로 또는 인터페이스 형식에서 해당 인터페이스를 구현하는 값 형식으로 변환하는 것을 말합니다.

```
int i = 123;
object o = i;
int j = (int)o;
```

언박싱 과정은 두가지의 절차를 거친다.

```
1. 개체 인스턴스가 지정한 값 형식을 boxing한 값인지 확인
2. 인스턴스의 값을 값 형식 변수에 복사
```

![image-20200116142248165](../../image\image-20200116142248165.png)

위의 그림에서 보면 int를 박싱한 o의 객체를 다시 int 타입의 j 값에 넣고 있습니다.



언박싱을 할 때 다른 타입으로 하거나, 해당 타입보다 작은 범위로 변환하려면 오류가 발생

이때는 미리 같은 타입인지 확인 절차 거쳐야 합니다.

그 후에 캐스팅해야 안전합니다.





3. 결론

```
This can take up to 20 times longer than a simple reference assignment. When unboxing, the casting process can take four times as long as an assignment.



-박싱을 하면 단순히 참조에 할당하는 것보다 20배까지 시간이 소모되며, 언박싱은 할당에 4배정도 소모된다.


박싱과 언박싱에는 많은 시간이 소모됩니다. 

되도록이면 제네릭을 사용해서 박싱과 언박싱이 일어나지 않도록 구성을 해야하며, 어쩔 수 없이 사용하려면 그 타입에 맞는 캐스팅을 해서 오류가 없이 처리해야합니다.
```

