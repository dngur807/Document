### PrefView

> 고성능 .Net 코어 프로그래밍 책 참고

시스템에 등록된 모든 ETW 공급자의 목록을 살펴보려면 명령 프롬포트를 열고 

```
logman query providers | more
```

ETW 이벤트를 수집하고 분석할 수 있는 도구

1. 설치가 필요 없다.
2. 구성이 편하다
3. 쉽게 스크립트화 할 수 있다.
4. 아주 상제한 수준으로 이벤트를 골라 캡처 가능 예를 들어 단 몇 가지 이벤트 범주를 몇 시간 동안 추적 가능
5. 모니터링하는 머신이나 프로세스에 끼치는 영향이 미미
6. 스택 그룹화와 접기 기능이 탁월
7. 내장 스택 그룹화와 접기 기능을 이용하는 확장으로 PerfView를 사용자 정의 할 수 있다.



PerfView를 사용할 때 묻는 질문

* CPU 사용량의 추세는 어디로 가나?
* 어디서 가장 많은 메모리 할당이 일어나나
* 어떤 유형에서 할당이 가장 많이 일어나는가?
* Gen 2 가비지 수집을 일으키는 것은 무엇인가?
* 평균 Gen 0 수집이 얼마나 오래 걸리는가?
* 자신의 코드에서 JITting 을 얼마나 많이 수행하는가?
* 가장 경합이 많이 일어나는 잠금은 무엇인가?
* 관리되는 힙은 어떤 상태인가?



PerfView를 사용해 이벤트를 수집하고 분석하려면 다음의 기본 단계를 따른다.

1. Collect 메뉴에서 Collect 메뉴 항목 선택

2. 결과 대화 상자에서 필요한 옵션을 선택

   a. [Advanced Options] 를 확장해 캡처하려는 이벤트의 유형을 선택

   b. NET 3.5를 사용하지 않는다면 No V3SX 를 체크한다.

   c. 선택으로 Max Collect Sec를 지정해 주어진 시간 이후의 컬렉션을 자동으로 중지

3. [Start Collection] 버튼을 클릭
4.  Max Collect Sec 값을 사용하지 않는다면 끝났을 때 Stop Collection을 클릭
5. 해당 이벤트가 처리되는 동안 대기
6. 결과 트리에서 사용할 뷰를 선택

이벤트를 수집하는 동안 PerfView는 모든 프로세스에 대한 ETW 이벤트를 캡처한다.

컬렉션을 완료 한 후 프로세스 단위로 이벤트 필터링할 수 있다.